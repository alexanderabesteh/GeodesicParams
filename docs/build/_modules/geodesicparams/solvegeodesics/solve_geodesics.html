

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>geodesicparams.solvegeodesics.solve_geodesics &mdash; GeodesicParams 0.2.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=66b59bf7" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=37f418d5"></script>
      <script src="../../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            GeodesicParams
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"></div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">GeodesicParams</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">geodesicparams.solvegeodesics.solve_geodesics</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for geodesicparams.solvegeodesics.solve_geodesics</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Top level procedure for computing the solutions functions for the r, theta, and phi</span>
<span class="sd">components of the geodesic equation in Plebanski-Demianski spacetimes.</span>

<span class="sd">As of now, solutions have been implemented for the following spacetimes:</span>
<span class="sd">Schwarzschild, Reissner Nordstrom, Kerr, Kerr-Newman, Schwarzschild-de Sitter,</span>
<span class="sd">Reissner Nordstrom-de Sitter, Kerr-de Sitter, and Kerr-Newman-de Sitter.</span>
<span class="sd"> </span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">mpmath</span> <span class="kn">import</span> <span class="n">mp</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">vectorize</span>
<span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">symbols</span><span class="p">,</span> <span class="n">degree</span><span class="p">,</span> <span class="n">Poly</span><span class="p">,</span> <span class="n">re</span><span class="p">,</span> <span class="n">Eq</span><span class="p">,</span> <span class="n">solve</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">pprint</span>

<span class="kn">from</span> <span class="nn">.solve_eom</span> <span class="kn">import</span> <span class="n">invert_eom</span><span class="p">,</span> <span class="n">integrate_eom</span>
<span class="kn">from</span> <span class="nn">.general_relativity</span> <span class="kn">import</span> <span class="n">get_allowed_orbits</span><span class="p">,</span> <span class="n">convert_boundsinit</span><span class="p">,</span> <span class="n">check_rinitials</span><span class="p">,</span> <span class="n">check_thetainitials</span><span class="p">,</span> <span class="n">classify_spacetime</span><span class="p">,</span> <span class="n">four_velocity</span><span class="p">,</span> <span class="n">check_orbit_types</span>
<span class="kn">from</span> <span class="nn">.substitution</span> <span class="kn">import</span> <span class="n">convert_polynomial</span> 
<span class="kn">from</span> <span class="nn">..utilities</span> <span class="kn">import</span> <span class="n">inlist</span><span class="p">,</span> <span class="n">eval_roots</span>

<div class="viewcode-block" id="solve_geodesic_orbit">
<a class="viewcode-back" href="../../../geodesicparams.solvegeodesics.html#geodesicparams.solvegeodesics.solve_geodesics.solve_geodesic_orbit">[docs]</a>
<span class="k">def</span> <span class="nf">solve_geodesic_orbit</span><span class="p">(</span><span class="n">b_mass</span><span class="p">,</span> <span class="n">rot</span><span class="p">,</span> <span class="n">eCharge</span><span class="p">,</span> <span class="n">cosmo</span><span class="p">,</span> <span class="n">NUT</span><span class="p">,</span> <span class="n">mCharge</span><span class="p">,</span> <span class="n">speed_light</span><span class="p">,</span> <span class="n">grav_const</span><span class="p">,</span> <span class="n">perm</span><span class="p">,</span> <span class="n">particle_light</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="n">ang_mom</span><span class="p">,</span> <span class="n">carter</span><span class="p">,</span> <span class="n">p_mass</span><span class="p">,</span> <span class="n">orbittype</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> 
                   <span class="n">initial_values</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">initial_directions</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">time</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">periodM</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the r, theta, and phi coordinates of the geodesic equation as </span>
<span class="sd">    a function of mino time.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    b_mass : float</span>
<span class="sd">        A positive non-zero float representing the mass of the larger body.</span>
<span class="sd">    rot : float</span>
<span class="sd">        A postive float representing the rotation of the larger body.</span>
<span class="sd">    eCharge : float</span>
<span class="sd">        A float representing the electric charge of the larger body.</span>
<span class="sd">    cosmo: float</span>
<span class="sd">        A float representing the cosmological constant.</span>
<span class="sd">    NUT : float</span>
<span class="sd">        A float representing the NUT parameter.</span>
<span class="sd">    mCharge : float</span>
<span class="sd">        A float representing the magnetic charge of the larger body.</span>
<span class="sd">    speed_light : float</span>
<span class="sd">        A float representing the speed of light.</span>
<span class="sd">    grav_const : float</span>
<span class="sd">        A float representing the universal gravitational constant.</span>
<span class="sd">    perm : float</span>
<span class="sd">        A float representing the permittivity of free space.</span>
<span class="sd">    particle_light : integer</span>
<span class="sd">        An integer, either 1 (for timelike geodesics) or 0 (for null geodesics).</span>
<span class="sd">    energy : float</span>
<span class="sd">        A float representing the energy of the smaller body.</span>
<span class="sd">    ang_mom : float</span>
<span class="sd">        A float reperesenting the angular momentum of the smaller body.</span>
<span class="sd">    carter : float</span>
<span class="sd">        A float representing the carter constant.</span>
<span class="sd">    p_mass : float</span>
<span class="sd">        A positive float representing the mass of the smaller body.</span>
<span class="sd">    orbittype : string</span>
<span class="sd">        A string representing the type of orbit to be modelled.</span>
<span class="sd">    config : list</span>
<span class="sd">        A list containing either 2 or 3 elements: a string, the path to</span>
<span class="sd">        the working directory; a string, the current date (in any format);</span>
<span class="sd">        and an integer, the binary precision. The working directory and date strings</span>
<span class="sd">        are required, while the default binary precision is 53.</span>
<span class="sd">    initial_values : list, optional</span>
<span class="sd">        A list of floats representing the initial values: the initial mino time,</span>
<span class="sd">        r value, theta value, and phi value.</span>
<span class="sd">    initial_directions : list, optional</span>
<span class="sd">        A list of 2 integers, either +1 or -1, representing the initial directions</span>
<span class="sd">        of the r and theta components of the 4-velocity. -1 as the r value means the </span>
<span class="sd">        smaller body initially moves towards the larger body, while +1 means the smaller</span>
<span class="sd">        body initially moves away.</span>
<span class="sd">    time : bool, optional</span>
<span class="sd">        A boolean encoding whether or not the coordinate time component of the geodesic</span>
<span class="sd">        equation should be computed (True meaning yes, False meanign no). NOTE: NOT </span>
<span class="sd">        IMPLEMENTED, TBD.</span>
<span class="sd">    periodM : list, optional</span>
<span class="sd">        A list of two matrices, each 1x2 when the cosmological constant is 0 (cosmo = 0) or </span>
<span class="sd">        2x4 when the cosmological constant isn&#39;t 0 (cosmo != 0), representing the period </span>
<span class="sd">        matrices of the riemann surfaces defined by the r and theta components of the </span>
<span class="sd">        4-velocity. When cosmo = 0, the first element of th</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list </span>
<span class="sd">        A list of 3 lambda functions: the r, theta, and phi components of the geodesic</span>
<span class="sd">        equation as a function of mino time. The arguments of these lambda functions can</span>
<span class="sd">        vary, however; they can either be an individual number, or a list of numbers. This</span>
<span class="sd">        depends on the spacetimes and specific coordinate:</span>

<span class="sd">        1. The phi coordinate, regardless of spacetime, always accepts a list of numbers </span>
<span class="sd">        as an argument.</span>
<span class="sd">        2. For spacetimes with vanishing cosmological constants (cosmo = 0) both the r and theta</span>
<span class="sd">        coordinates accept individual numbers as arguments.</span>
<span class="sd">        3. For spacetimes with non-vanishing cosmological constants (cosmo != 0), the r coordinate</span>
<span class="sd">        accepts a list of numbers as an argument, while the theta coordinate accepts individual values</span>
<span class="sd">        as an argument.</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span> 

    <span class="c1"># Catch wrong inputs</span>
    <span class="k">if</span> <span class="n">b_mass</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">rot</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">p_mass</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="p">(</span><span class="n">particle_light</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">particle_light</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Parameters are not feasible&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">orbittype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;bound&quot;</span><span class="p">,</span> <span class="s2">&quot;inner bound&quot;</span><span class="p">,</span> <span class="s2">&quot;middle bound&quot;</span><span class="p">,</span> <span class="s2">&quot;flyby&quot;</span><span class="p">,</span> <span class="s2">&quot;terminating&quot;</span><span class="p">,</span> <span class="s2">&quot;crossover bound&quot;</span><span class="p">,</span> <span class="s2">&quot;transit&quot;</span><span class="p">,</span> <span class="s2">&quot;terminating escape&quot;</span><span class="p">,</span> <span class="s2">&quot;crossover flyby&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Type of orbit </span><span class="si">{</span><span class="n">orbittype</span><span class="si">}</span><span class="s2"> is not allowed&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">orbittype</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;transit&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">orbittype</span><span class="si">}</span><span class="s2"> orbits have not been implemented. tbd&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">config</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">workdir</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">prec</span> <span class="o">=</span> <span class="n">config</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">config</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">workdir</span><span class="p">,</span> <span class="n">date</span> <span class="o">=</span> <span class="n">config</span>
        <span class="n">prec</span> <span class="o">=</span> <span class="mi">53</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid declaration of config&quot;</span><span class="p">)</span>

    <span class="c1"># Set precision</span>
    <span class="n">mp</span><span class="o">.</span><span class="n">prec</span> <span class="o">=</span> <span class="n">prec</span>
    <span class="n">digits</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">dps</span>

    <span class="c1"># Determine spacetime</span>
    <span class="n">spacetime</span> <span class="o">=</span> <span class="n">classify_spacetime</span><span class="p">(</span><span class="n">eCharge</span><span class="p">,</span> <span class="n">rot</span><span class="p">,</span> <span class="n">cosmo</span><span class="p">,</span> <span class="n">NUT</span><span class="p">)</span>

    <span class="n">check_orbit_types</span><span class="p">(</span><span class="n">orbittype</span><span class="p">,</span> <span class="n">particle_light</span><span class="p">,</span> <span class="n">spacetime</span><span class="p">)</span>

    <span class="n">p_r</span><span class="p">,</span> <span class="n">p_nu</span><span class="p">,</span> <span class="n">phi_integrands</span> <span class="o">=</span> <span class="n">four_velocity</span><span class="p">(</span><span class="n">b_mass</span><span class="p">,</span> <span class="n">rot</span><span class="p">,</span> <span class="n">eCharge</span><span class="p">,</span> <span class="n">cosmo</span><span class="p">,</span> <span class="n">NUT</span><span class="p">,</span> <span class="n">mCharge</span><span class="p">,</span> <span class="n">speed_light</span><span class="p">,</span> <span class="n">grav_const</span><span class="p">,</span> <span class="n">perm</span><span class="p">,</span> <span class="n">particle_light</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="n">ang_mom</span><span class="p">,</span> <span class="n">carter</span><span class="p">,</span> <span class="n">p_mass</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s2">&quot;x y r&quot;</span><span class="p">)</span>
    <span class="c1">############################# r Equation ################################</span>
    <span class="c1"># ----------- Define rhs of (dr/dgamma)**2 = p(r)</span>
    <span class="n">deg_p</span> <span class="o">=</span> <span class="n">degree</span><span class="p">(</span><span class="n">p_r</span><span class="p">)</span>

    <span class="c1"># ----------- Check orbittype</span>
    <span class="k">if</span> <span class="n">rot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1">#spacetime in [&quot;Schwarzschild&quot;, &quot;Reissner Nordstrom&quot;, &quot;Schwarzschild-de Sitter&quot;, &quot;Reissner Nordstrom-de Sitter&quot;]:</span>
        <span class="n">types</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">zeros_p</span> <span class="o">=</span> <span class="n">get_allowed_orbits</span><span class="p">(</span><span class="n">p_r</span><span class="p">,</span> <span class="n">deg_p</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">types</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">zeros_p</span> <span class="o">=</span> <span class="n">get_allowed_orbits</span><span class="p">(</span><span class="n">p_r</span><span class="p">,</span> <span class="n">deg_p</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">inlist</span><span class="p">(</span><span class="s2">&quot;transit&quot;</span><span class="p">,</span> <span class="n">types</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="c1"># or inlist(&quot;crossover flyby&quot;, types) != -1:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">orbittype</span><span class="si">}</span><span class="s2"> orbits have not been implemented. tbd&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">inlist</span><span class="p">(</span><span class="n">orbittype</span><span class="p">,</span> <span class="n">types</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;orbittype </span><span class="si">{</span><span class="n">orbittype</span><span class="si">}</span><span class="s2"> is not allowed&quot;</span><span class="p">)</span>

    <span class="c1"># ----------- Check initial values</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">initial_values</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">initial_values</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid declaration of initial_values </span><span class="si">{</span><span class="n">initial_values</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">initial_directions</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">initial_directions</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid declaration of initial directions </span><span class="si">{</span><span class="n">initial_directions</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Define initial directions</span>
    <span class="k">if</span> <span class="n">initial_directions</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">r_dir</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">theta_dir</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">r_dir</span> <span class="o">=</span> <span class="n">initial_directions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">theta_dir</span> <span class="o">=</span> <span class="n">initial_directions</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Check initial r value</span>
    <span class="k">if</span> <span class="n">initial_values</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">init_r</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">init_r</span> <span class="o">=</span> <span class="n">initial_values</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">init_r</span> <span class="o">=</span> <span class="n">check_rinitials</span><span class="p">(</span><span class="n">initial_values</span><span class="p">,</span> <span class="n">orbittype</span><span class="p">,</span> <span class="n">types</span><span class="p">,</span> <span class="n">bounds</span><span class="p">)</span>

    <span class="c1"># ----------- Convert p to standard form</span>
    <span class="c1"># Output convert_polynomial: [converted_polynomial, integrand, substitution]</span>
    <span class="c1"># i.e. (dr/dgamma)**2 = integrand(y) * (converted_polynomial)</span>
    <span class="n">p_converted</span> <span class="o">=</span> <span class="n">convert_polynomial</span><span class="p">(</span><span class="n">p_r</span><span class="p">,</span> <span class="n">deg_p</span><span class="p">,</span> <span class="n">zeros_p</span><span class="p">,</span> <span class="n">bounds</span><span class="p">[</span><span class="n">inlist</span><span class="p">(</span><span class="n">orbittype</span><span class="p">,</span> <span class="n">types</span><span class="p">)])</span>
    <span class="n">zeros_converted</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">eval_roots</span><span class="p">(</span><span class="n">Poly</span><span class="p">(</span><span class="n">p_converted</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">all_roots</span><span class="p">()),</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">y</span> <span class="p">:</span> <span class="n">re</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
 
    <span class="c1"># Apply substitution to bounds and initial_values</span>
    <span class="n">eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p_converted</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">inverse_substitution</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">eqn</span><span class="p">,</span> <span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">bounds_converted</span><span class="p">,</span> <span class="n">init_converted</span> <span class="o">=</span> <span class="n">convert_boundsinit</span><span class="p">(</span><span class="n">bounds</span><span class="p">,</span> <span class="n">init_r</span><span class="p">,</span> <span class="n">inlist</span><span class="p">(</span><span class="n">orbittype</span><span class="p">,</span> <span class="n">types</span><span class="p">),</span> <span class="n">inverse_substitution</span><span class="p">,</span> <span class="n">zeros_converted</span><span class="p">)</span>
    <span class="n">dir_converted</span> <span class="o">=</span> <span class="o">-</span> <span class="n">p_converted</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">r_dir</span>

    <span class="c1"># ----------- Solution function</span>
    <span class="n">sol_r</span> <span class="o">=</span> <span class="n">invert_eom</span><span class="p">(</span><span class="n">p_converted</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">zeros_converted</span><span class="p">,</span> <span class="n">p_converted</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">init_converted</span><span class="p">,</span> <span class="n">dir_converted</span><span class="p">,</span> <span class="n">p_converted</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">digits</span><span class="p">,</span> <span class="n">periodM</span><span class="p">,</span> <span class="n">workdir</span> <span class="o">+</span> <span class="s2">&quot;temp/rdata_&quot;</span> <span class="o">+</span> <span class="n">date</span><span class="p">)</span>

    <span class="c1">############################# Phi Equation, r Integral ################################</span>
    <span class="c1"># Define rhs of dphi/dgamma = phir_integrand - phinu_integrand</span>
    <span class="c1">#phir_integrand = phi_integrands[0] / sqrt(p_converted[1].subs(y, inverse_substitution).subs(x, r)).simplify()</span>
    <span class="n">phir_integrand</span> <span class="o">=</span> <span class="n">phi_integrands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">p_converted</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">phir_integrand</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">sol_phir</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sol_phir</span> <span class="o">=</span> <span class="n">integrate_eom</span><span class="p">(</span><span class="n">p_converted</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">zeros_converted</span><span class="p">,</span> <span class="n">p_converted</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">phir_integrand</span><span class="p">,</span> <span class="n">workdir</span> <span class="o">+</span> <span class="s2">&quot;temp/rdata_&quot;</span> <span class="o">+</span> <span class="n">date</span><span class="p">,</span> <span class="n">digits</span><span class="p">)</span>

    <span class="c1">############################# theta Equation ################################</span>
    <span class="c1"># ----------- Define rhs of (dnu/dgamma)**2 = p(nu), nu = cos(theta)</span>
    <span class="n">deg_p</span> <span class="o">=</span> <span class="n">degree</span><span class="p">(</span><span class="n">p_nu</span><span class="p">)</span>
    <span class="n">zeros_p</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">eval_roots</span><span class="p">(</span><span class="n">Poly</span><span class="p">(</span><span class="n">p_nu</span><span class="p">)</span><span class="o">.</span><span class="n">all_roots</span><span class="p">()),</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">y</span> <span class="p">:</span> <span class="n">re</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Zeros = &quot;</span><span class="p">,</span> <span class="n">zeros_p</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">zeros_p</span><span class="p">)</span> <span class="o">!=</span> <span class="n">deg_p</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;could not find all zeros of underlying polynomial&quot;</span><span class="p">)</span>

    <span class="c1"># ----------- Range of theta and initial values</span>
    <span class="n">allowed_theta_inits</span><span class="p">,</span> <span class="n">init_nu</span><span class="p">,</span> <span class="n">bounds_nu</span> <span class="o">=</span> <span class="n">check_thetainitials</span><span class="p">(</span><span class="n">zeros_p</span><span class="p">,</span> <span class="n">initial_values</span><span class="p">)</span>

    <span class="c1"># ----------- Convert p to standard form</span>
    <span class="c1"># Output convert_polynomial: [converted_polynomial, integrand, substitution]</span>
    <span class="n">p_converted</span> <span class="o">=</span> <span class="n">convert_polynomial</span><span class="p">(</span><span class="n">p_nu</span><span class="p">,</span> <span class="n">deg_p</span><span class="p">,</span> <span class="n">zeros_p</span><span class="p">,</span> <span class="n">bounds_nu</span><span class="p">)</span>
    <span class="n">zeros_converted</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">eval_roots</span><span class="p">(</span><span class="n">Poly</span><span class="p">(</span><span class="n">p_converted</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">all_roots</span><span class="p">()),</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">y</span> <span class="p">:</span> <span class="n">re</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
 
    <span class="c1"># Apply substitution to initial_values</span>
    <span class="n">eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p_converted</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">inverse_substitution</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">eqn</span><span class="p">,</span> <span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">bounds_converted</span><span class="p">,</span> <span class="n">init_converted</span> <span class="o">=</span> <span class="n">convert_boundsinit</span><span class="p">(</span><span class="n">bounds_nu</span><span class="p">,</span> <span class="n">init_nu</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">inverse_substitution</span><span class="p">,</span> <span class="n">zeros_converted</span><span class="p">)</span>
    <span class="n">dir_converted</span> <span class="o">=</span> <span class="o">-</span><span class="n">p_converted</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">theta_dir</span><span class="p">)</span>
    
    <span class="c1"># ----------- Determine solution olution function</span>
    <span class="n">sol_nu</span> <span class="o">=</span> <span class="n">invert_eom</span><span class="p">(</span><span class="n">p_converted</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">zeros_converted</span><span class="p">,</span> <span class="n">p_converted</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">init_converted</span><span class="p">,</span> <span class="n">dir_converted</span><span class="p">,</span> <span class="n">p_converted</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">digits</span><span class="p">,</span> <span class="n">periodM</span><span class="p">,</span> <span class="n">workdir</span> <span class="o">+</span> <span class="s2">&quot;temp/thetadata_&quot;</span> <span class="o">+</span> <span class="n">date</span><span class="p">)</span>

    <span class="c1"># Backsubstitution theta = arccos(nu)</span>
    <span class="k">if</span> <span class="n">deg_p</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
        <span class="n">acos</span> <span class="o">=</span> <span class="n">vectorize</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">acos</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">)</span>
        <span class="n">sol_theta</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span> <span class="p">:</span> <span class="n">acos</span><span class="p">(</span><span class="n">sol_nu</span><span class="p">(</span><span class="n">s</span><span class="p">))</span> 
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sol_theta</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span> <span class="p">:</span> <span class="n">mp</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">sol_nu</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>

    <span class="c1">############################# Phi Equation, theta Integral ################################</span>
    <span class="c1"># Define rhs of dphi/dgamma = phir_integrand - phinu_integrand</span>
    <span class="n">phinu_integrand</span> <span class="o">=</span> <span class="n">phi_integrands</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">p_converted</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="c1">#.simplify()</span>
    <span class="n">sol_phinu</span> <span class="o">=</span> <span class="n">integrate_eom</span><span class="p">(</span><span class="n">p_converted</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">zeros_converted</span><span class="p">,</span> <span class="n">p_converted</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">phinu_integrand</span><span class="p">,</span> <span class="n">workdir</span> <span class="o">+</span> <span class="s2">&quot;temp/thetadata_&quot;</span> <span class="o">+</span> <span class="n">date</span><span class="p">,</span> <span class="n">digits</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">initial_values</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">init_phi</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="n">init_phi</span> <span class="o">=</span> <span class="n">initial_values</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">sol_phi</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">sol_phir</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">phir</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">phir</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sol_phir</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>

        <span class="n">phinu</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sol_phinu</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>

        <span class="n">s</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
       
        <span class="k">if</span> <span class="n">phir</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">init_phi</span> <span class="o">+</span> <span class="n">re</span><span class="p">(</span><span class="n">phir</span> <span class="o">-</span> <span class="n">phinu</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">))]</span>
        <span class="k">else</span><span class="p">:</span>
           <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">init_phi</span> <span class="o">+</span> <span class="n">re</span><span class="p">(</span><span class="n">phir</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">phinu</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">phir</span><span class="p">))]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">sol_r</span><span class="p">,</span> <span class="n">sol_theta</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">s</span> <span class="p">:</span> <span class="n">sol_phi</span><span class="p">(</span><span class="n">s</span><span class="p">)]</span></div>



<div class="viewcode-block" id="solve_geodesic_time">
<a class="viewcode-back" href="../../../geodesicparams.solvegeodesics.html#geodesicparams.solvegeodesics.solve_geodesics.solve_geodesic_time">[docs]</a>
<span class="k">def</span> <span class="nf">solve_geodesic_time</span><span class="p">():</span>
    <span class="k">return</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="solve_geodesic_worldline">
<a class="viewcode-back" href="../../../geodesicparams.solvegeodesics.html#geodesicparams.solvegeodesics.solve_geodesics.solve_geodesic_worldline">[docs]</a>
<span class="k">def</span> <span class="nf">solve_geodesic_worldline</span><span class="p">():</span>

    <span class="k">return</span> <span class="mi">0</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Alexander Abesteh.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>