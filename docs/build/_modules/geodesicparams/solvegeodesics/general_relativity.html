

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>geodesicparams.solvegeodesics.general_relativity &mdash; GeodesicParams 0.2.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=66b59bf7" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=37f418d5"></script>
      <script src="../../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            GeodesicParams
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"></div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">GeodesicParams</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">geodesicparams.solvegeodesics.general_relativity</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for geodesicparams.solvegeodesics.general_relativity</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">A collection of functions related to the checking the initial values, orbits, and spacetimes</span>
<span class="sd">as well as defining the four-velocity of a space time.</span>

<span class="sd">The possible orbit types are the following:</span>
<span class="sd">&quot;terminating&quot;, &quot;terminating escape&quot;, &quot;bound&quot;, &quot;inner bound&quot;, middle bound&quot;, &quot;flyby&quot;,</span>
<span class="sd">&quot;crossover flyby&quot;, &quot;transit&quot; (&quot;crossover flyby&quot; and &quot;transit&quot; have not been implemented, tbd).</span>

<span class="sd">As of now, the following spacetimes have been implemented:</span>
<span class="sd">Schwarzschild, Reissner Nordstrom, Kerr, Kerr-Newman, Schwarzschild-de Sitter,</span>
<span class="sd">Reissner Nordstrom-de Sitter, Kerr-de Sitter, and Kerr-Newman-de Sitter.</span>
<span class="sd"> </span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">Poly</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">Symbol</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">symbols</span><span class="p">,</span> <span class="n">oo</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">re</span>

<span class="kn">from</span> <span class="nn">..utilities</span> <span class="kn">import</span> <span class="n">inlist</span><span class="p">,</span> <span class="n">separate_zeros</span><span class="p">,</span> <span class="n">find_next</span><span class="p">,</span> <span class="n">eval_roots</span>

<div class="viewcode-block" id="get_allowed_orbits">
<a class="viewcode-back" href="../../../geodesicparams.solvegeodesics.html#geodesicparams.solvegeodesics.general_relativity.get_allowed_orbits">[docs]</a>
<span class="k">def</span> <span class="nf">get_allowed_orbits</span><span class="p">(</span><span class="n">polynomial</span><span class="p">,</span> <span class="n">deg</span><span class="p">,</span> <span class="n">isnegativeallowed</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determine the possible orbit types from a given polynomial as well as</span>
<span class="sd">    their respective boundaries.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    polynomial : symbolic</span>
<span class="sd">        A symbolic statement representing the polynomial to be converted.</span>
<span class="sd">    deg : integer</span>
<span class="sd">        The degree of &lt;polynomial&gt;.</span>
<span class="sd">    isnegativeallowed : boolean, optional</span>
<span class="sd">        If set to True, negative radial values are allowed, meaning that transit and</span>
<span class="sd">        crossover flyby orbits are possible, and terminating orbits are not possible.</span>
<span class="sd">        (transit and crossover flyby orbits have not been implemented yet, tbd).</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    types : list</span>
<span class="sd">        A list of strings representing the possible orbit types for &lt;polynomial&gt;.</span>
<span class="sd">    bounds : list</span>
<span class="sd">        A list containing the bounds for each orbit type.</span>
<span class="sd">    zeros : list</span>
<span class="sd">        A list of complex or real numbers representing the zeros of &lt;polynomial&gt;.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">p</span> <span class="o">=</span> <span class="n">polynomial</span>

    <span class="n">zeros</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">eval_roots</span><span class="p">(</span><span class="n">Poly</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">all_roots</span><span class="p">()),</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">y</span> <span class="p">:</span> <span class="n">re</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Zeros = &quot;</span><span class="p">,</span> <span class="n">zeros</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">zeros</span><span class="p">)</span> <span class="o">!=</span> <span class="n">deg</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;could not find all zeros of underlying polynomial.&quot;</span><span class="p">)</span>

    <span class="n">realNS</span><span class="p">,</span> <span class="n">complexNS</span> <span class="o">=</span> <span class="n">separate_zeros</span><span class="p">(</span><span class="n">zeros</span><span class="p">)</span>

   <span class="c1"># if len(realNS) == 0:</span>
    <span class="c1">#    raise Exception(&quot;Underlying polynomial has only complex zeros: this case is not supported.&quot;)</span>
    
    <span class="c1"># Determine positive real zeros</span>
    <span class="n">pos_zeros</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">realNS</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">realNS</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">evalf</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">pos_zeros</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">realNS</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    
    <span class="c1"># ------ Possible orbit types</span>
    <span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pos_zeros</span><span class="p">)</span>
    <span class="n">max_coeff</span> <span class="o">=</span> <span class="n">Poly</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">all_coeffs</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">types</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">bounds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">isnegativeallowed</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">realNS</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;crossover flyby&quot;</span><span class="p">]</span>
                <span class="n">bounds</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="n">oo</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;transit&quot;</span><span class="p">]</span>
                <span class="n">bounds</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="n">oo</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;terminating escape&quot;</span><span class="p">]</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="n">oo</span><span class="p">]]</span>

    <span class="c1"># ------ P to infinity for x to infinity</span>
    <span class="k">if</span> <span class="n">max_coeff</span><span class="o">.</span><span class="n">evalf</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">while</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">isnegativeallowed</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">zeros</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pos_zeros</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;crossover bound&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;crossover flyby&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;terminating&quot;</span><span class="p">)</span>
                <span class="n">bounds</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">pos_zeros</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
                <span class="n">k</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;bound&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;inner bound&quot;</span><span class="p">)</span>
                <span class="n">bounds</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pos_zeros</span><span class="p">[</span><span class="n">count</span><span class="p">],</span> <span class="n">pos_zeros</span><span class="p">[</span><span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]])</span>
                <span class="n">k</span> <span class="o">-=</span> <span class="mi">2</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">2</span>
            <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;flyby&quot;</span><span class="p">)</span>
                <span class="n">bounds</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pos_zeros</span><span class="p">[</span><span class="n">count</span><span class="p">],</span> <span class="n">oo</span><span class="p">])</span>
                <span class="n">k</span> <span class="o">-=</span> <span class="mi">1</span>

    <span class="c1"># ------ P to -infinity for x to infinity</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">while</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">isnegativeallowed</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">zeros</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pos_zeros</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;crossover bound&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;crossover flyby&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;terminating&quot;</span><span class="p">)</span>
                <span class="n">bounds</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">pos_zeros</span><span class="p">[</span><span class="n">count</span><span class="p">]])</span>
                <span class="n">k</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;bound&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">pos_zeros</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
                    <span class="n">types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;middle bound&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;inner bound&quot;</span><span class="p">)</span>
                <span class="n">bounds</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pos_zeros</span><span class="p">[</span><span class="n">count</span><span class="p">],</span> <span class="n">pos_zeros</span><span class="p">[</span><span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]])</span>
                <span class="n">k</span> <span class="o">-=</span> <span class="mi">2</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">2</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;bounds = &quot;</span><span class="p">,</span> <span class="n">bounds</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Possible orbittypes: &quot;</span><span class="p">,</span> <span class="n">types</span><span class="p">)</span>
<span class="c1">#    if inlist(orbittype, types) == -1:</span>
     <span class="c1">#   raise Exception(f&quot;orbittype {orbittype} is not allowed&quot;)</span>
    <span class="k">return</span> <span class="n">types</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">zeros</span></div>


<div class="viewcode-block" id="convert_boundsinit">
<a class="viewcode-back" href="../../../geodesicparams.solvegeodesics.html#geodesicparams.solvegeodesics.general_relativity.convert_boundsinit">[docs]</a>
<span class="k">def</span> <span class="nf">convert_boundsinit</span><span class="p">(</span><span class="n">bounds</span><span class="p">,</span> <span class="n">initial_values</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">substitution</span><span class="p">,</span> <span class="n">zeros_subs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a set of boundaries and initial values by applying &lt;substitution&gt;.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    bounds : list</span>
<span class="sd">        A list of boundaries for orbit types to be converted, where each boundary is a list</span>
<span class="sd">        containing a minimal and maximal value for each orbit type.</span>
<span class="sd">    initial_values : list</span>
<span class="sd">        A list of two elements, the first being the initial mino time, the second being</span>
<span class="sd">        a spacetime coordinate.</span>
<span class="sd">    position : integer</span>
<span class="sd">        An index such that bounds[position][0] &lt; initial_values[1] &lt; bounds[position][1].</span>
<span class="sd">    substitution : symbolic</span>
<span class="sd">        A symbolic statement, the substitution created by convert_polynomial.</span>
<span class="sd">    zeros_subs : list</span>
<span class="sd">        A list of complex or real numbers, the zeros converted by convert_polynomial.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bounds_converted : list</span>
<span class="sd">        A list containing the converted bounds for each orbit type.</span>
<span class="sd">    init_converted : list</span>
<span class="sd">        A list of containing the converted initial values.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">bounds_converted</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">Symbol</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
    
    <span class="c1"># Apply substitution to bounds</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bounds</span><span class="p">)):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">element1</span> <span class="o">=</span> <span class="n">limit</span><span class="p">(</span><span class="n">substitution</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">bounds</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Numeric exception: division by zero.&quot;</span><span class="p">)</span>
            <span class="n">element1</span> <span class="o">=</span> <span class="n">oo</span>
        <span class="k">if</span> <span class="n">element1</span> <span class="o">!=</span> <span class="n">oo</span><span class="p">:</span>
            <span class="n">element1</span> <span class="o">=</span> <span class="n">find_next</span><span class="p">(</span><span class="n">element1</span><span class="p">,</span> <span class="n">zeros_subs</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">element2</span> <span class="o">=</span> <span class="n">limit</span><span class="p">(</span><span class="n">substitution</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">bounds</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Numeric exception: division by zero.&quot;</span><span class="p">)</span>
            <span class="n">element2</span> <span class="o">=</span> <span class="n">oo</span>
        <span class="k">if</span> <span class="n">element2</span> <span class="o">!=</span> <span class="n">oo</span><span class="p">:</span>
            <span class="n">element2</span> <span class="o">=</span> <span class="n">find_next</span><span class="p">(</span><span class="n">element2</span><span class="p">,</span> <span class="n">zeros_subs</span><span class="p">)</span>
        <span class="n">bounds_converted</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">element1</span><span class="p">,</span> <span class="n">element2</span><span class="p">])</span>

    <span class="c1"># Apply substitution to initial values</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">initial_values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">bounds</span><span class="p">[</span><span class="n">position</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">initial_values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">bounds</span><span class="p">[</span><span class="n">position</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">limit</span><span class="p">(</span><span class="n">substitution</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">initial_values</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">init_converted</span> <span class="o">=</span> <span class="p">[</span><span class="n">initial_values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">find_next</span><span class="p">(</span><span class="n">limit</span><span class="p">(</span><span class="n">substitution</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">initial_values</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">bounds_converted</span><span class="p">[</span><span class="n">position</span><span class="p">])]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Numeric exception: division by zero.&quot;</span><span class="p">)</span>
            <span class="n">init_converted</span> <span class="o">=</span> <span class="p">[</span><span class="n">initial_values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">oo</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">limit</span><span class="p">(</span><span class="n">substitution</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">initial_values</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">init_converted</span> <span class="o">=</span> <span class="p">[</span><span class="n">initial_values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">limit</span><span class="p">(</span><span class="n">substitution</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">initial_values</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Numeric exception: division by zero.&quot;</span><span class="p">)</span>
            <span class="n">init_converted</span> <span class="o">=</span> <span class="p">[</span><span class="n">initial_values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">oo</span><span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;converted bounds = &quot;</span><span class="p">,</span> <span class="n">bounds_converted</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bounds_converted</span><span class="p">,</span> <span class="n">init_converted</span></div>


<div class="viewcode-block" id="check_rinitials">
<a class="viewcode-back" href="../../../geodesicparams.solvegeodesics.html#geodesicparams.solvegeodesics.general_relativity.check_rinitials">[docs]</a>
<span class="k">def</span> <span class="nf">check_rinitials</span><span class="p">(</span><span class="n">initial_values</span><span class="p">,</span> <span class="n">orbittype</span><span class="p">,</span> <span class="n">types</span><span class="p">,</span> <span class="n">bounds</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks or sets the initial values for the r motion as necessairy.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    initial_values : list</span>
<span class="sd">        A list of two elements, the first being the initial mino time, the second being the</span>
<span class="sd">        initial r coordinate value.</span>
<span class="sd">    orbittype : string</span>
<span class="sd">        A string encoding the orbit to be computed.</span>
<span class="sd">    types : list</span>
<span class="sd">        A list of strings representing the possible orbit types.</span>
<span class="sd">    bounds : list</span>
<span class="sd">        A list of boundaries for each orbit type, where each boundary is a list</span>
<span class="sd">        containing a minimal and maximal value for each orbit type.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    initial_values : list</span>
<span class="sd">        A list of containing the initial values: if they were correct/not empty, they </span>
<span class="sd">        were returned unchanged. Otherwise, they were set to the default values: </span>
<span class="sd">        0 as the first element, then either the maximal r value if the orbit does not reach</span>
<span class="sd">        infinite, or the minimal r value.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Error parameter</span>
    <span class="n">eps</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">)</span>

    <span class="c1"># Set initial values to defaults if empty</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">initial_values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">orbittype</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;flyby&quot;</span><span class="p">,</span> <span class="s2">&quot;crossover flyby&quot;</span><span class="p">,</span> <span class="s2">&quot;terminating escape&quot;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">bounds</span><span class="p">[</span><span class="n">inlist</span><span class="p">(</span><span class="n">orbittype</span><span class="p">,</span> <span class="n">types</span><span class="p">)][</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">bounds</span><span class="p">[</span><span class="n">inlist</span><span class="p">(</span><span class="n">orbittype</span><span class="p">,</span> <span class="n">types</span><span class="p">)][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">eps</span><span class="p">]</span>

    <span class="c1"># Modify initial values to defaults if incorrect</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="n">inlist</span><span class="p">(</span><span class="n">orbittype</span><span class="p">,</span> <span class="n">types</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">initial_values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">initial_values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">bounds</span><span class="p">[</span><span class="n">inlist</span><span class="p">(</span><span class="n">orbittype</span><span class="p">,</span> <span class="n">types</span><span class="p">)][</span><span class="mi">1</span><span class="p">]):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WARNING in check_rinitials: initial value </span><span class="si">{</span><span class="n">initial_values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> is not allowed for orbittype </span><span class="si">{</span><span class="n">orbittype</span><span class="si">}</span><span class="s2">; set to default value.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">orbittype</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;flyby&quot;</span><span class="p">,</span> <span class="s2">&quot;crossover flyby&quot;</span><span class="p">,</span> <span class="s2">&quot;terminating escape&quot;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">initial_values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bounds</span><span class="p">[</span><span class="n">inlist</span><span class="p">(</span><span class="n">orbittype</span><span class="p">,</span> <span class="n">types</span><span class="p">)][</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">initial_values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bounds</span><span class="p">[</span><span class="n">inlist</span><span class="p">(</span><span class="n">orbittype</span><span class="p">,</span> <span class="n">types</span><span class="p">)][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">eps</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">initial_values</span></div>


<div class="viewcode-block" id="check_thetainitials">
<a class="viewcode-back" href="../../../geodesicparams.solvegeodesics.html#geodesicparams.solvegeodesics.general_relativity.check_thetainitials">[docs]</a>
<span class="k">def</span> <span class="nf">check_thetainitials</span><span class="p">(</span><span class="n">zeros</span><span class="p">,</span> <span class="n">initial_values</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks or sets the initial values for the theta motion as necessairy.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    zeros : list</span>
<span class="sd">        A list of complex or real numbers representing the roots of theta polynomial.</span>
<span class="sd">        </span>
<span class="sd">    initial_values : list</span>
<span class="sd">        A list of two elements, the first being the initial mino time, the second being the</span>
<span class="sd">        initial r coordinate value.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    allowed_inits : list</span>
<span class="sd">        A list containing the zeros that could be initial values of nu = cos(theta).</span>
<span class="sd">    init_nu : list</span>
<span class="sd">        A list of containing the initial values: if they were correct/not empty, they </span>
<span class="sd">        were returned unchanged. Otherwise, they were set to the default values: </span>
<span class="sd">        0 as the first element, then pi/2 if possible or the maximal theta value in</span>
<span class="sd">        the nothern hemisphere.</span>
<span class="sd">    bounds_nu : list</span>
<span class="sd">        A list containing the extremal nu values for which init_nu[1] is bounded. Two</span>
<span class="sd">        sets of bounds are possible.</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="n">realNS</span><span class="p">,</span> <span class="n">complexNS</span> <span class="o">=</span> <span class="n">separate_zeros</span><span class="p">(</span><span class="n">zeros</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">realNS</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;underlying polynomial has only complex zeros; this case is not supported.&quot;</span><span class="p">)</span>
    
    <span class="n">allowed_inits</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">eps</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">)</span>

    <span class="c1"># Check for real zeros in between -1 &lt;= 0 &lt;= 1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">realNS</span><span class="p">)):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">realNS</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">realNS</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">allowed_inits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">realNS</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">allowed_inits</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">allowed_inits</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">allowed_inits</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Bounds for theta motion are not allowed&quot;</span><span class="p">)</span>

    <span class="c1"># Determine bounds</span>
    <span class="n">allowed_inits</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">allowed_inits</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">bounds_nu</span> <span class="o">=</span> <span class="p">[[</span><span class="n">allowed_inits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">allowed_inits</span><span class="p">[</span><span class="mi">1</span><span class="p">]]]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">bounds_nu</span> <span class="o">=</span> <span class="p">[[</span><span class="n">allowed_inits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">allowed_inits</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="n">allowed_inits</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">allowed_inits</span><span class="p">[</span><span class="mi">3</span><span class="p">]]]</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Allowed initial_values for nu=cos(theta) motion: &quot;</span><span class="p">,</span> <span class="n">bounds_nu</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># Set default values</span>
    <span class="k">if</span> <span class="n">initial_values</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">init_nu</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">allowed_inits</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="c1"># Check if initial values that were entered are correct</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cos_init</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">initial_values</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">allowed_inits</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="p">(</span><span class="n">cos_init</span><span class="o">.</span><span class="n">evalf</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">allowed_inits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">cos_init</span><span class="o">.</span><span class="n">evalf</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">allowed_inits</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WARNING in check_thetainitials: initial value </span><span class="si">{</span><span class="n">initial_values</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2"> for theta motion is not allowed; set to default value </span><span class="si">{</span><span class="n">allowed_inits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">init_nu</span> <span class="o">=</span> <span class="p">[</span><span class="n">initial_values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">allowed_inits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">eps</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">allowed_inits</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">and</span> <span class="p">((</span><span class="n">cos_init</span><span class="o">.</span><span class="n">evalf</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">allowed_inits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">cos_init</span><span class="o">.</span><span class="n">evalf</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">allowed_inits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="n">cos_init</span><span class="o">.</span><span class="n">evalf</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">allowed_inits</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">or</span> <span class="n">cos_init</span><span class="o">.</span><span class="n">evalf</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">allowed_inits</span><span class="p">[</span><span class="mi">3</span><span class="p">])):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WARNING in check_thetainitials: initial value </span><span class="si">{</span><span class="n">initial_values</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2"> for theta motion is not allowed; set to default value </span><span class="si">{</span><span class="n">allowed_inits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">init_nu</span> <span class="o">=</span> <span class="p">[</span><span class="n">initial_values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">allowed_inits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">eps</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">init_nu</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">cos_init</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">allowed_inits</span><span class="p">,</span> <span class="n">init_nu</span><span class="p">,</span> <span class="n">bounds_nu</span></div>


<div class="viewcode-block" id="classify_spacetime">
<a class="viewcode-back" href="../../../geodesicparams.solvegeodesics.html#geodesicparams.solvegeodesics.general_relativity.classify_spacetime">[docs]</a>
<span class="k">def</span> <span class="nf">classify_spacetime</span><span class="p">(</span><span class="n">eCharge</span><span class="p">,</span> <span class="n">rot</span><span class="p">,</span> <span class="n">cosmo</span><span class="p">,</span> <span class="n">NUT</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Classify a spacetime based on the parameters entered.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    eCharge : float</span>
<span class="sd">        The electric charge on the larger body.</span>
<span class="sd">    rot : float</span>
<span class="sd">        The rotating parameter on the larger body.</span>
<span class="sd">    cosmo : float</span>
<span class="sd">        The cosmological constant.</span>
<span class="sd">    NUT : float</span>
<span class="sd">        The NUT parameter.</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    string</span>
<span class="sd">        The spacetime defined by the parameters entered.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Determine space-time</span>
    <span class="k">if</span> <span class="n">NUT</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># Static space-times</span>
        <span class="k">if</span> <span class="n">rot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Schwarzschild</span>
            <span class="k">if</span> <span class="n">cosmo</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">eCharge</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Schwarzschild&quot;</span>
            <span class="c1"># Reissner Nordstrom</span>
            <span class="k">elif</span> <span class="n">cosmo</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Reissner Nordstrom&quot;</span>
            <span class="c1"># Schwarzschild-de Sitter</span>
            <span class="k">elif</span> <span class="n">eCharge</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Schwarzschild-de Sitter&quot;</span>
            <span class="c1"># Reissner Nordstrom-de Sitter</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Reissner Nordstrom-de Sitter&quot;</span>
        <span class="c1"># Stationary space-times</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Kerr</span>
            <span class="k">if</span> <span class="n">cosmo</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">eCharge</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Kerr&quot;</span>
            <span class="c1"># Kerr-Newman</span>
            <span class="k">elif</span> <span class="n">cosmo</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Kerr-Newman&quot;</span>
            <span class="c1"># Kerr-de Sitter</span>
            <span class="k">elif</span> <span class="n">eCharge</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Kerr-de Sitter&quot;</span>
            <span class="c1"># Kerr-Newman-de Sitter</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Kerr-Newman-de Sitter&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;unknown space-time.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="check_orbit_types">
<a class="viewcode-back" href="../../../geodesicparams.solvegeodesics.html#geodesicparams.solvegeodesics.general_relativity.check_orbit_types">[docs]</a>
<span class="k">def</span> <span class="nf">check_orbit_types</span><span class="p">(</span><span class="n">orbittype</span><span class="p">,</span> <span class="n">particle_light</span><span class="p">,</span> <span class="n">spacetime</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if an orbittype is possible in a given spacetime, raise exception if it is not.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    orbittype : string</span>
<span class="sd">        A string representing the type of orbit to be modelled.</span>
<span class="sd">    particle_light : integer</span>
<span class="sd">        An integer, either 1 (for timelike geodesics) or 0 (for null geodesics).</span>
<span class="sd">    spacetime : string</span>
<span class="sd">        The spacetime to be checked against the orbittype.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">spacetime</span> <span class="o">==</span> <span class="s2">&quot;Schwarzschild&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">orbittype</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;inner bound&quot;</span><span class="p">,</span> <span class="s2">&quot;middle bound&quot;</span><span class="p">,</span> <span class="s2">&quot;crossover bound&quot;</span><span class="p">,</span> <span class="s2">&quot;transit&quot;</span><span class="p">,</span> <span class="s2">&quot;crossover flyby&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Orbit type </span><span class="si">{</span><span class="n">orbittype</span><span class="si">}</span><span class="s2"> is not possible in the Schwarzschild space-time.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">orbittype</span> <span class="o">==</span> <span class="s2">&quot;bound&quot;</span> <span class="ow">and</span> <span class="n">particle_light</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Orbit type </span><span class="si">{</span><span class="n">orbittype</span><span class="si">}</span><span class="s2"> is not possible for null geodesics in the Schwarzschild space-time.&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">spacetime</span> <span class="o">==</span> <span class="s2">&quot;Reissner Nordstrom&quot;</span><span class="p">:</span>
        <span class="c1"># Check orbittype</span>
        <span class="k">if</span> <span class="n">orbittype</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;middle bound&quot;</span><span class="p">,</span> <span class="s2">&quot;terminating&quot;</span><span class="p">,</span> <span class="s2">&quot;terminating escape&quot;</span><span class="p">,</span> <span class="s2">&quot;crossover bound&quot;</span><span class="p">,</span> <span class="s2">&quot;transit&quot;</span><span class="p">,</span> <span class="s2">&quot;crossover flyby&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Orbit type </span><span class="si">{</span><span class="n">orbittype</span><span class="si">}</span><span class="s2"> is not possible in the Reissner-Nordström space-time.&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">spacetime</span> <span class="o">==</span> <span class="s2">&quot;Schwarzschild-de Sitter&quot;</span><span class="p">:</span>
        <span class="c1"># Check orbittype</span>
        <span class="k">if</span> <span class="n">orbittype</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;middle bound&quot;</span><span class="p">,</span> <span class="s2">&quot;crossover bound&quot;</span><span class="p">,</span> <span class="s2">&quot;transit&quot;</span><span class="p">,</span> <span class="s2">&quot;crossover flyby&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Orbit type </span><span class="si">{</span><span class="n">orbittype</span><span class="si">}</span><span class="s2"> is not possible in the Schwarzschild-de Sitter space-time.&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">spacetime</span> <span class="o">==</span> <span class="s2">&quot;Reissner Nordstrom-de Sitter&quot;</span><span class="p">:</span>
        <span class="c1"># Check orbittype</span>
        <span class="k">if</span> <span class="n">orbittype</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;middle bound&quot;</span><span class="p">,</span> <span class="s2">&quot;terminating&quot;</span><span class="p">,</span> <span class="s2">&quot;terminating escape&quot;</span><span class="p">,</span> <span class="s2">&quot;crossover bound&quot;</span><span class="p">,</span> <span class="s2">&quot;transit&quot;</span><span class="p">,</span> <span class="s2">&quot;crossover flyby&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Orbit type </span><span class="si">{</span><span class="n">orbittype</span><span class="si">}</span><span class="s2"> is not possible in the Reissner-Nordström-de Sitter space-time.&quot;</span><span class="p">)</span>

    <span class="c1"># Axially symmetrical space-times</span>
    <span class="k">elif</span> <span class="n">spacetime</span> <span class="o">==</span> <span class="s2">&quot;Kerr&quot;</span><span class="p">:</span>
        <span class="c1"># Check orbit type</span>
        <span class="k">if</span> <span class="n">orbittype</span> <span class="o">==</span> <span class="s2">&quot;middle bound&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Orbittype </span><span class="si">{</span><span class="n">orbittype</span><span class="si">}</span><span class="s2"> is not allowed in the Kerr space-time.&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">spacetime</span> <span class="o">==</span> <span class="s2">&quot;Kerr-Newman&quot;</span><span class="p">:</span>
        <span class="c1"># Check orbit type</span>
        <span class="k">if</span> <span class="n">orbittype</span> <span class="o">==</span> <span class="s2">&quot;middle bound&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Orbittype </span><span class="si">{</span><span class="n">orbittype</span><span class="si">}</span><span class="s2"> is not allowed in the Kerr-Newman space-time.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="four_velocity">
<a class="viewcode-back" href="../../../geodesicparams.solvegeodesics.html#geodesicparams.solvegeodesics.general_relativity.four_velocity">[docs]</a>
<span class="k">def</span> <span class="nf">four_velocity</span><span class="p">(</span><span class="n">b_mass</span><span class="p">,</span> <span class="n">rot</span><span class="p">,</span> <span class="n">eCharge</span><span class="p">,</span> <span class="n">cosmo</span><span class="p">,</span> <span class="n">NUT</span><span class="p">,</span> <span class="n">mCharge</span><span class="p">,</span> <span class="n">speed_light</span><span class="p">,</span> <span class="n">grav_const</span><span class="p">,</span> <span class="n">perm</span><span class="p">,</span> <span class="n">particle_light</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="n">ang_mom</span><span class="p">,</span> <span class="n">carter</span><span class="p">,</span> <span class="n">p_mass</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the four velocity of a spacetime. The eigentime is also computed.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    b_mass : float</span>
<span class="sd">        A positive non-zero float representing the mass of the larger body.</span>
<span class="sd">    rot : float</span>
<span class="sd">        A postive float representing the rotation of the larger body.</span>
<span class="sd">    eCharge : float</span>
<span class="sd">        A float representing the electric charge of the larger body.</span>
<span class="sd">    cosmo: float</span>
<span class="sd">        A float representing the cosmological constant.</span>
<span class="sd">    NUT : float</span>
<span class="sd">        A float representing the NUT parameter.</span>
<span class="sd">    mCharge : float</span>
<span class="sd">        A float representing the magnetic charge of the larger body.</span>
<span class="sd">    speed_light : float</span>
<span class="sd">        A float representing the speed of light.</span>
<span class="sd">    grav_const : float</span>
<span class="sd">        A float representing the universal gravitational constant.</span>
<span class="sd">    perm : float</span>
<span class="sd">        A float representing the permittivity of free space.</span>
<span class="sd">    particle_light : integer</span>
<span class="sd">        An integer, either 1 (for timelike geodesics) or 0 (for null geodesics).</span>
<span class="sd">    energy : float</span>
<span class="sd">        A float representing the energy of the smaller body.</span>
<span class="sd">    ang_mom : float</span>
<span class="sd">        A float reperesenting the angular momentum of the smaller body.</span>
<span class="sd">    carter : float</span>
<span class="sd">        A float representing the carter constant.</span>
<span class="sd">    p_mass : float</span>
<span class="sd">        A positive float representing the mass of the smaller body.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list</span>
<span class="sd">        The 4-velocity defined by the parameters entered. The phi and t coordinates are</span>
<span class="sd">        returned as a list, each containing two components: the r and theta components.</span>
<span class="sd">        The eigentime is also return as the 4 element.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">r</span><span class="p">,</span> <span class="n">nu</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s2">&quot;r nu&quot;</span><span class="p">)</span>

    <span class="c1"># Constants </span>
    <span class="n">schw_r</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">grav_const</span> <span class="o">*</span> <span class="n">b_mass</span> <span class="o">/</span> <span class="n">speed_light</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">rot</span> <span class="o">/</span> <span class="n">b_mass</span>
    <span class="n">rQ</span> <span class="o">=</span> <span class="n">eCharge</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">grav_const</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">perm</span> <span class="o">*</span> <span class="n">speed_light</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span>

    <span class="c1"># Account for particle mass</span>
    <span class="n">ang_mom</span> <span class="o">=</span> <span class="n">ang_mom</span> <span class="o">/</span> <span class="n">p_mass</span>
    <span class="n">energy</span> <span class="o">=</span> <span class="n">energy</span> <span class="o">/</span> <span class="n">p_mass</span>
    <span class="n">carter</span> <span class="o">=</span> <span class="n">carter</span> <span class="o">/</span> <span class="n">p_mass</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">particle_light</span> <span class="o">=</span> <span class="n">particle_light</span> <span class="o">*</span> <span class="n">p_mass</span><span class="o">**</span><span class="mi">2</span>
    
    <span class="n">spacetime</span> <span class="o">=</span> <span class="n">classify_spacetime</span><span class="p">(</span><span class="n">eCharge</span><span class="p">,</span> <span class="n">rot</span><span class="p">,</span> <span class="n">cosmo</span><span class="p">,</span> <span class="n">NUT</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">spacetime</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Kerr&quot;</span><span class="p">,</span> <span class="s2">&quot;Kerr-Newman&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">spacetime</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Kerr-de Sitter&quot;</span><span class="p">,</span> <span class="s2">&quot;Kerr-Newman-de Sitter&quot;</span><span class="p">]:</span>
        <span class="n">chi</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">chi</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">cosmo</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span>

    <span class="c1"># Simplifications</span>
    <span class="n">p_r</span> <span class="o">=</span> <span class="n">energy</span> <span class="o">*</span> <span class="p">(</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">NUT</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">a</span> <span class="o">*</span> <span class="n">ang_mom</span>
    <span class="n">t_nu</span> <span class="o">=</span> <span class="n">energy</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">nu</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">NUT</span> <span class="o">*</span> <span class="n">nu</span><span class="p">)</span> <span class="o">-</span> <span class="n">ang_mom</span>

    <span class="c1"># Horizon functions</span>
    <span class="n">delta_r</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">cosmo</span><span class="o">/</span><span class="mi">3</span> <span class="o">*</span> <span class="n">r</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">cosmo</span> <span class="o">*</span> <span class="n">NUT</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">NUT</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">schw_r</span> <span class="o">*</span> <span class="n">r</span> <span class="o">+</span> <span class="n">rQ</span> <span class="o">+</span> <span class="n">mCharge</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span><span class="o">/</span><span class="mi">3</span> <span class="o">*</span> <span class="n">cosmo</span> <span class="o">*</span> <span class="n">NUT</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span><span class="o">.</span><span class="n">evalf</span><span class="p">()</span>
    <span class="n">delta_nu</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="mi">3</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">cosmo</span> <span class="o">*</span> <span class="n">nu</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span><span class="o">/</span><span class="mi">3</span> <span class="o">*</span> <span class="n">cosmo</span> <span class="o">*</span> <span class="n">a</span>  <span class="o">*</span> <span class="n">NUT</span>  <span class="o">*</span> <span class="n">nu</span>
   
    <span class="c1"># Coordinate velocities</span>
    <span class="n">r_vel</span> <span class="o">=</span> <span class="p">(</span><span class="n">chi</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">p_r</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">delta_r</span> <span class="o">*</span> <span class="p">(</span><span class="n">particle_light</span> <span class="o">*</span> <span class="n">r</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">carter</span><span class="p">))</span><span class="o">.</span><span class="n">expand</span><span class="p">()</span>
    <span class="n">nu_vel</span> <span class="o">=</span> <span class="p">(</span><span class="n">delta_nu</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">nu</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">carter</span> <span class="o">-</span> <span class="n">particle_light</span> <span class="o">*</span> <span class="p">(</span><span class="n">NUT</span> <span class="o">-</span> <span class="n">a</span> <span class="o">*</span> <span class="n">nu</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">chi</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">t_nu</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">expand</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">NUT</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">nu_vel</span> <span class="o">=</span> <span class="n">nu_vel</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">nu</span><span class="o">**</span><span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">phi_vel</span> <span class="o">=</span> <span class="p">[</span><span class="n">chi</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">p_r</span> <span class="o">/</span> <span class="n">delta_r</span><span class="p">)</span><span class="o">.</span><span class="n">simplify</span><span class="p">(),</span> <span class="n">chi</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">t_nu</span> <span class="o">/</span> <span class="p">(</span><span class="n">delta_nu</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">nu</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span><span class="o">.</span><span class="n">simplify</span><span class="p">()]</span>
    <span class="n">t_vel</span> <span class="o">=</span> <span class="p">[</span><span class="n">chi</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">((</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">NUT</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">p_r</span> <span class="o">/</span> <span class="n">delta_r</span><span class="p">)</span><span class="o">.</span><span class="n">simplify</span><span class="p">(),</span> <span class="n">chi</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">((</span><span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">nu</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">NUT</span> <span class="o">*</span> <span class="n">nu</span><span class="p">)</span> <span class="o">*</span> <span class="n">t_nu</span> <span class="o">/</span> <span class="p">(</span><span class="n">delta_nu</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">nu</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span><span class="o">.</span><span class="n">simplify</span><span class="p">()]</span>
    <span class="n">proper_vel</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="p">((</span><span class="n">NUT</span> <span class="o">-</span> <span class="n">a</span> <span class="o">*</span> <span class="n">nu</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">simplify</span><span class="p">()]</span> 

    <span class="k">return</span> <span class="p">[</span><span class="n">r_vel</span><span class="p">,</span> <span class="n">nu_vel</span><span class="p">,</span> <span class="n">phi_vel</span><span class="p">,</span> <span class="n">t_vel</span><span class="p">,</span> <span class="n">proper_vel</span><span class="p">]</span></div>


<span class="c1">#def compute_phi_vals(spacetime, inverse_substituttion, datafile):</span>
<span class="c1">#</span>
 <span class="c1">#   if spacetime == &quot;Schwarzschild&quot;:</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Alexander Abesteh.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>